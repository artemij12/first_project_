Основные тезисы.
- Прибор обязательно юстировать (расчеты по диметру крыльчатки, диметру канала, предполагаемой скорости протекания жидкости окажутся очень не точными. Надеяться на то, что поток жидкости будет ламинарным не возможно..
Больше скажу он обязательно будет турбулентным. придется усреднять)
- Задача достичь точности хотя бы в 0,1-0,3 %. На 100 литрах это будет 100-300 мл....Максимум 500 достичь иначе все не есть хорошо
- В приборе предполагается две кнопки (третья на разрыв питания вкл/выкл, ноги не задействуются). Одна мультикнопка (выбор режима), другая старт/стоп. Нам лишние ноги камня задействовать не сильно надо.
  Алгорит работы вырисовывается следующий:
   - нажимаешь кнопку выбора режима (по очереди отображаются по кругу все режимы):
        Приблизительно меню будет выгледеть так:
        Жмем кнoпу Set
        - Юстировка(U на экране)-> Кнопка Пуск-> На экране "00.00"->Жмем кнопку Set на экране увеличиваются цифры (это тот объем которым будем юстировать)-> выставили объем-> Нажали Пуск(зажатие кнопки Пуск скидывает в ноль) 
                     -> Жмем Пуск (льем жидкость) -> После того как объем пролит жмем кратковременно Пуск (и данные заносятся в таблицу , таблица не большая в EEPROM, при разных объемах и разной скрости подачи
                        по математической формуле высчитывает число оборотов при протекании соотвествующего объема жидкости)
                        Условно графы таблицы (Объем/количество оборотов/коэффициент скорости). Затем набрав статистику выводим усредненный коэффициент (линейный)... Матмодель пока требует доработки...
                        После практических испытаний возможно придется подправить
        - Работа (W)-> Жмем пуск-> после того как бак налился жмем еще раз Пуск-> На экране число литров-> Сброс или по питанию или зажимом кнопки  
    - выбрав режим нажимаешь кнопку  пуск (кнопка без залипания, все время контролим в каком обе кнопки состоянии, можно конечно сделать и с залипанием и еще накинуть функций, но то такое, работаем так,кнопка на разрыв/замыкание)
        - так же работает таймер по прерыванию , обработчик прерывания высчитывает и выводит на экран результат вычислений. Запуск таймера просходит после выбора режима 
-В основной функции loop() у нас происходит только обработка нажатий клавиш и вывод на экран информации. По нажатию этих клавиш прибор будет переходить в то или иное состояние. 
NB! Теперь математика. Я посмотрел твою программу... Имеет место быть..Но все проще в итоге. Я не проверял но уверен на 99% , что построенные на такой же как у нас схеме счетчики воды максимально тупые.
Они не высчитывают периоды открытия закрытия датчика, в них нет сложных математических формул. Там просто прикинули сколько воды проходит через эту трубу и просто сичтают количество открытий закрытий датчика.
Юстировку,читай поверку, приборка превоначально провели и узнали, что при прокачке 100 литров воды через крыльчатку она прокрутится условных 10 000 раз, а при прокачке с меньшим давление за то же время 10 литров воды
она прокрутится условных 1000 раз..взяли погрешность на турбулентность и у них точность до литра...Согласен нас это не устраивает!!! НО в начале давай попробуем выводить коэффициенты на разных скоростях и разном объеме.
Все что нужно это считать количество прерываний крыльчаткой оптопары и время за которое это происходит ...Самое интересно , что мы можем ввести несколько счетчиков. Условно один считает с периодом 1 мс, другой 10, третий 100
и потом по формуле апроксимамции кривых достаточно четко вычислить объем проходящей жидкости...Если много не понятно я потом поясню..Пока давай сделаем дубовый счетчик. Потом программно его легко усложнить
Я кстати так и задумывал ...Математическими методами физику если не обмануть, то сильно сгладить и уменьшить погрешность)))
P.S. в моих стройных рассуждениях может крыться одна большая засада, время срабатывания оптопары. Если придется ставить редуктор (при большой скорости вращения крыльчатки ), то это сильно понизит точность .
Я в итоге от редуктора решил отказаться..в надежде на то , что электронные компоненты успеют отработать..в часности оптопара           
P.P.S. Задачка тестовая, если воплотится в реально работающий прибор, можно пить шампанское, хотя...для такого прибора и по стопке водки будет достаточно)))
